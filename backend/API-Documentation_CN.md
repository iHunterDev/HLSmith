# HLSmith åç«¯ API æ¥å£æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [åŸºç¡€ä¿¡æ¯](#åŸºç¡€ä¿¡æ¯)
- [å“åº”æ ¼å¼è§„èŒƒ](#å“åº”æ ¼å¼è§„èŒƒ)
- [è®¤è¯æ–¹å¼](#è®¤è¯æ–¹å¼)
- [ç³»ç»Ÿæ¥å£](#ç³»ç»Ÿæ¥å£)
- [ç”¨æˆ·è®¤è¯æ¨¡å—](#ç”¨æˆ·è®¤è¯æ¨¡å—)
- [è§†é¢‘ç®¡ç†æ¨¡å—](#è§†é¢‘ç®¡ç†æ¨¡å—)
- [HLSè½¬æ¢æ¨¡å—](#hlsè½¬æ¢æ¨¡å—)
- [æµåª’ä½“æ’­æ”¾æ¨¡å—](#æµåª’ä½“æ’­æ”¾æ¨¡å—)
- [è§†é¢‘åˆ†äº«æ¨¡å—](#è§†é¢‘åˆ†äº«æ¨¡å—)
- [é˜Ÿåˆ—ç®¡ç†æ¨¡å—](#é˜Ÿåˆ—ç®¡ç†æ¨¡å—)
- [åˆ†ç‰‡ä¸Šä¼ æ¨¡å—](#åˆ†ç‰‡ä¸Šä¼ æ¨¡å—)
- [é”™è¯¯ç è¯´æ˜](#é”™è¯¯ç è¯´æ˜)
- [æ•°æ®ç»“æ„å®šä¹‰](#æ•°æ®ç»“æ„å®šä¹‰)

## åŸºç¡€ä¿¡æ¯

### æœåŠ¡å™¨ä¿¡æ¯
- **Base URL**: `http://localhost:3001`
- **é»˜è®¤ç«¯å£**: 3001
- **APIå‰ç¼€**: `/api`
- **Content-Type**: `application/json`

### ç‰ˆæœ¬ä¿¡æ¯
- **APIç‰ˆæœ¬**: v1.0.0
- **æ–‡æ¡£æ›´æ–°**: 2023å¹´12æœˆ

## å“åº”æ ¼å¼è§„èŒƒ

### ç»Ÿä¸€å“åº”ç»“æ„
æ‰€æœ‰APIæ¥å£éƒ½éµå¾ªä»¥ä¸‹ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```typescript
interface ApiResponse<T = any> {
  success: boolean;          // è¯·æ±‚æ˜¯å¦æˆåŠŸ
  code: number;             // HTTPçŠ¶æ€ç 
  message: string;          // å“åº”æ¶ˆæ¯
  data?: T;                 // å“åº”æ•°æ®
  error?: ErrorDetail;      // é”™è¯¯è¯¦æƒ…
  meta?: ResponseMeta;      // å…ƒæ•°æ®ä¿¡æ¯
  timestamp: string;        // å“åº”æ—¶é—´æˆ³
}
```

### æˆåŠŸå“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

### åˆ†é¡µå“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–åˆ—è¡¨æˆåŠŸ",
  "data": [ ... ],
  "meta": {
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "pages": 3,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹
```json
{
  "success": false,
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": {
    "type": "VALIDATION_ERROR",
    "code": "INVALID_PARAMS",
    "message": "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º",
    "details": {
      "fields": ["username", "password"]
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

## è®¤è¯æ–¹å¼

### JWT Token è®¤è¯
- **è®¤è¯æ–¹å¼**: Bearer Token
- **è¯·æ±‚å¤´**: `Authorization: Bearer <token>`
- **Tokenè·å–**: é€šè¿‡ç™»å½•æ¥å£è·å–
- **Tokenæœ‰æ•ˆæœŸ**: æ ¹æ®æœåŠ¡å™¨é…ç½®

### ç¤ºä¾‹
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## ç³»ç»Ÿæ¥å£

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

#### GET `/`
**æè¿°**: æ£€æŸ¥æœåŠ¡åŸºæœ¬çŠ¶æ€

**è®¤è¯**: æ— éœ€è®¤è¯

**å“åº”**:
```json
{
  "success": true,
  "code": 200,
  "message": "HLSmith åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸",
  "data": {
    "message": "HLSmith Backend Server",
    "status": "running",
    "version": "1.0.0"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

### 2. å¥åº·æ£€æŸ¥

#### GET `/api/health`
**æè¿°**: è¯¦ç»†çš„æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥

**è®¤è¯**: æ— éœ€è®¤è¯

**å“åº”**:
```json
{
  "success": true,
  "code": 200,
  "message": "æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡",
  "data": {
    "status": "healthy",
    "timestamp": "2023-12-01T10:00:00.000Z",
    "uptime": 3600,
    "memory": {
      "rss": 50331648,
      "heapTotal": 20971520,
      "heapUsed": 15728640,
      "external": 1024
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

## ç”¨æˆ·è®¤è¯æ¨¡å—

Base URL: `/api/auth`

### 1. ç”¨æˆ·æ³¨å†Œ

#### POST `/api/auth/register`
**æè¿°**: æ³¨å†Œæ–°ç”¨æˆ·è´¦å·

**è®¤è¯**: æ— éœ€è®¤è¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "string",     // ç”¨æˆ·åï¼Œå¿…å¡«
  "email": "string",        // é‚®ç®±åœ°å€ï¼Œå¿…å¡«ï¼Œå”¯ä¸€
  "password": "string"      // å¯†ç ï¼Œå¿…å¡«ï¼Œè‡³å°‘6ä½
}
```

**æˆåŠŸå“åº” (201)**:
```json
{
  "success": true,
  "code": 201,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "created_at": "2023-12-01T10:00:00.000Z",
      "updated_at": "2023-12-01T10:00:00.000Z"
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆç”¨æˆ·å/é‚®ç®±/å¯†ç ä¸ºç©ºï¼Œå¯†ç é•¿åº¦ä¸è¶³ï¼‰
- `409` - ç”¨æˆ·å·²å­˜åœ¨ï¼ˆé‚®ç®±æˆ–ç”¨æˆ·åé‡å¤ï¼‰

### 2. ç”¨æˆ·ç™»å½•

#### POST `/api/auth/login`
**æè¿°**: ç”¨æˆ·ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ

**è®¤è¯**: æ— éœ€è®¤è¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "email": "string",        // é‚®ç®±åœ°å€ï¼Œå¿…å¡«
  "password": "string"      // å¯†ç ï¼Œå¿…å¡«
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "created_at": "2023-12-01T10:00:00.000Z",
      "updated_at": "2023-12-01T10:00:00.000Z"
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆé‚®ç®±æˆ–å¯†ç ä¸ºç©ºï¼‰
- `401` - è®¤è¯å¤±è´¥ï¼ˆé‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼‰

### 3. è·å–ç”¨æˆ·ä¿¡æ¯

#### GET `/api/auth/profile`
**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯

**è®¤è¯**: éœ€è¦JWT Token

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "created_at": "2023-12-01T10:00:00.000Z",
    "updated_at": "2023-12-01T10:00:00.000Z"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®
- `404` - ç”¨æˆ·ä¸å­˜åœ¨

## è§†é¢‘ç®¡ç†æ¨¡å—

Base URL: `/api/videos`

**æ³¨æ„**: æ‰€æœ‰è§†é¢‘æ¥å£éƒ½éœ€è¦JWTè®¤è¯

### 1. ä¸Šä¼ è§†é¢‘

#### POST `/api/videos/upload`
**æè¿°**: ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ°æœåŠ¡å™¨

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
- `video` (file): è§†é¢‘æ–‡ä»¶ï¼Œå¿…å¡«
- `title` (string): è§†é¢‘æ ‡é¢˜ï¼Œå¿…å¡«

**æˆåŠŸå“åº” (201)**:
```json
{
  "success": true,
  "code": 201,
  "message": "è§†é¢‘ä¸Šä¼ æˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æµ‹è¯•è§†é¢‘",
    "original_filename": "video.mp4",
    "file_size": 10485760,
    "status": "uploaded",
    "conversion_progress": 0,
    "created_at": "2023-12-01T10:00:00.000Z",
    "updated_at": "2023-12-01T10:00:00.000Z"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆæœªé€‰æ‹©æ–‡ä»¶æˆ–æ ‡é¢˜ä¸ºç©ºï¼‰
- `401` - æœªæˆæƒè®¿é—®

### 2. è·å–è§†é¢‘åˆ—è¡¨

#### GET `/api/videos`
**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„è§†é¢‘åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰å’Œæ’åº

**è®¤è¯**: éœ€è¦JWT Token

**æŸ¥è¯¢å‚æ•°**:
- `page` (number, optional): é¡µç ï¼Œé»˜è®¤ä¸º1
- `limit` (number, optional): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ä¸º10ï¼Œæœ€å¤§100
- `q` (string, optional): æœç´¢å…³é”®è¯ï¼ˆæŒ‰æ ‡é¢˜æœç´¢ï¼‰
- `status` (string, optional): çŠ¶æ€ç­›é€‰ï¼ˆuploaded/processing/completed/failedï¼‰
- `start_date` (string, optional): å¼€å§‹æ—¥æœŸï¼ˆISO 8601æ ¼å¼ï¼‰
- `end_date` (string, optional): ç»“æŸæ—¥æœŸï¼ˆISO 8601æ ¼å¼ï¼‰
- `sort_by` (string, optional): æ’åºå­—æ®µï¼ˆcreated_at/updated_at/title/file_size/durationï¼‰ï¼Œé»˜è®¤ä¸ºcreated_at
- `sort_order` (string, optional): æ’åºæ–¹å‘ï¼ˆASC/DESCï¼‰ï¼Œé»˜è®¤ä¸ºDESC

**æŸ¥è¯¢å‚æ•°ç¤ºä¾‹**:
```
GET /api/videos?q=æµ‹è¯•&status=completed&sort_by=file_size&sort_order=ASC&page=1&limit=20
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–è§†é¢‘åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "title": "æµ‹è¯•è§†é¢‘",
      "original_filename": "video.mp4",
      "duration": 120,
      "file_size": 10485760,
      "status": "completed",
      "conversion_progress": 100,
      "thumbnail_url": "http://localhost:3001/thumbnails/2025/07/4/thumbnail.jpg",
      "hls_url": "http://localhost:3001/api/stream/1/playlist.m3u8",
      "created_at": "2023-12-01T10:00:00.000Z",
      "updated_at": "2023-12-01T10:00:00.000Z"
    }
  ],
  "meta": {
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "pages": 3,
      "has_next": true,
      "has_prev": false
    },
    "search": {
      "query": "æµ‹è¯•",
      "status": "completed",
      "start_date": null,
      "end_date": null,
      "sort_by": "file_size",
      "sort_order": "ASC"
    }
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†é¡µå‚æ•°é”™è¯¯ã€çŠ¶æ€å‚æ•°é”™è¯¯æˆ–æ’åºå‚æ•°é”™è¯¯
- `401` - æœªæˆæƒè®¿é—®

### 3. è·å–è§†é¢‘è¯¦æƒ…

#### GET `/api/videos/:id`
**æè¿°**: è·å–æŒ‡å®šè§†é¢‘çš„è¯¦ç»†ä¿¡æ¯

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–è§†é¢‘ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æµ‹è¯•è§†é¢‘",
    "original_filename": "video.mp4",
    "duration": 120,
    "file_size": 10485760,
    "status": "completed",
    "conversion_progress": 100,
    "thumbnail_url": "http://localhost:3001/thumbnails/2025/07/4/thumbnail.jpg",
    "hls_url": "http://localhost:3001/api/stream/1/playlist.m3u8",
    "created_at": "2023-12-01T10:00:00.000Z",
    "updated_at": "2023-12-01T10:00:00.000Z"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 4. è·å–è§†é¢‘çŠ¶æ€

#### GET `/api/videos/:id/status`
**æè¿°**: è·å–è§†é¢‘å¤„ç†çŠ¶æ€ï¼ˆä¸è·å–è§†é¢‘è¯¦æƒ…ç›¸åŒï¼‰

**è®¤è¯**: éœ€è¦JWT Token

**å“åº”**: åŒè·å–è§†é¢‘è¯¦æƒ…æ¥å£

### 5. æ›´æ–°è§†é¢‘ä¿¡æ¯

#### PUT `/api/videos/:id`
**æè¿°**: æ›´æ–°è§†é¢‘æ ‡é¢˜

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**è¯·æ±‚å‚æ•°**:
```json
{
  "title": "string"      // æ–°çš„è§†é¢‘æ ‡é¢˜ï¼Œå¿…å¡«
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è§†é¢‘ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æ–°æ ‡é¢˜",
    "original_filename": "video.mp4",
    "duration": 120,
    "file_size": 10485760,
    "status": "completed",
    "conversion_progress": 100,
    "thumbnail_url": "http://localhost:3001/thumbnails/2025/07/4/thumbnail.jpg",
    "hls_url": "http://localhost:3001/api/stream/1/playlist.m3u8",
    "created_at": "2023-12-01T10:00:00.000Z",
    "updated_at": "2023-12-01T10:01:00.000Z"
  },
  "timestamp": "2023-12-01T10:01:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆè§†é¢‘IDæ— æ•ˆæˆ–æ ‡é¢˜ä¸ºç©ºï¼‰
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 6. åˆ é™¤è§†é¢‘

#### DELETE `/api/videos/:id`
**æè¿°**: åˆ é™¤æŒ‡å®šè§†é¢‘å’Œç›¸å…³æ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è§†é¢‘åˆ é™¤æˆåŠŸ",
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 7. é‡è¯•è§†é¢‘å¤„ç†

#### POST `/api/videos/:id/retry`
**æè¿°**: é‡è¯•å¤±è´¥çš„è§†é¢‘å¤„ç†ä»»åŠ¡

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è§†é¢‘å¤„ç†é‡å¯æˆåŠŸ",
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯æˆ–ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆåªæœ‰å¤±è´¥çŠ¶æ€çš„è§†é¢‘æ‰èƒ½é‡è¯•ï¼‰
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 8. ç”Ÿæˆåˆ†äº«é“¾æ¥

#### POST `/api/videos/:id/share`
**æè¿°**: ä¸ºæŒ‡å®šè§†é¢‘ç”Ÿæˆæ°¸ä¹…åˆ†äº«é“¾æ¥

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "ç”Ÿæˆåˆ†äº«é“¾æ¥æˆåŠŸ",
  "data": {
    "id": 1,
    "video_id": 24,
    "access_token": "550e8400-e29b-41d4-a716-446655440000",
    "share_url": "http://localhost:3001/api/share/550e8400-e29b-41d4-a716-446655440000/playlist.m3u8",
    "created_at": "2024-07-16T12:00:00.000Z",
    "is_active": true,
    "access_count": 0
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨æˆ–å°šæœªå®Œæˆè½¬æ¢

### 9. è·å–è§†é¢‘åˆ†äº«åˆ—è¡¨

#### GET `/api/videos/:id/shares`
**æè¿°**: è·å–æŒ‡å®šè§†é¢‘çš„æ‰€æœ‰åˆ†äº«é“¾æ¥

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–åˆ†äº«é“¾æ¥åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "video_id": 24,
      "access_token": "550e8400-e29b-41d4-a716-446655440000",
      "share_url": "http://localhost:3001/api/share/550e8400-e29b-41d4-a716-446655440000/playlist.m3u8",
      "created_at": "2024-07-16T12:00:00.000Z",
      "is_active": true,
      "access_count": 15
    }
  ],
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 10. ä¸‹è½½åŸå§‹è§†é¢‘

#### GET `/api/videos/:id/download`
**æè¿°**: ä¸‹è½½æŒ‡å®šè§†é¢‘çš„åŸå§‹æ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
è¿”å›è§†é¢‘æ–‡ä»¶çš„äºŒè¿›åˆ¶æµæ•°æ®

**å“åº”å¤´**:
```
Content-Type: video/mp4
Content-Disposition: attachment; filename="åŸå§‹æ–‡ä»¶å.mp4"
Content-Length: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨
- `500` - åŸå§‹æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸‹è½½å¤±è´¥

## HLSè½¬æ¢æ¨¡å—

Base URL: `/api/hls`

**æ³¨æ„**: æ‰€æœ‰HLSæ¥å£éƒ½éœ€è¦JWTè®¤è¯

### 1. è½¬æ¢è§†é¢‘ä¸ºHLS

#### POST `/api/hls/:id/convert`
**æè¿°**: å°†è§†é¢‘è½¬æ¢ä¸ºHLSæ ¼å¼

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**è¯·æ±‚å‚æ•°**:
```json
{
  "quality": "string",      // å¯é€‰ï¼Œè½¬æ¢è´¨é‡ï¼šlow/medium/highï¼Œé»˜è®¤medium
  "resolution": "string"    // å¯é€‰ï¼Œåˆ†è¾¨ç‡ï¼š480p/720p/1080pï¼Œé»˜è®¤720p
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è§†é¢‘è½¬æ¢å·²åŠ å…¥é˜Ÿåˆ—",
  "data": {
    "videoId": 1,
    "jobId": 123,
    "status": "queued"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯æˆ–ä¸šåŠ¡é”™è¯¯ï¼ˆè§†é¢‘æ­£åœ¨å¤„ç†æˆ–å·²å®Œæˆï¼‰
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 2. è·å–è½¬æ¢çŠ¶æ€

#### GET `/api/hls/:id/status`
**æè¿°**: è·å–è§†é¢‘è½¬æ¢çŠ¶æ€å’Œé˜Ÿåˆ—ä¿¡æ¯

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–è½¬æ¢çŠ¶æ€æˆåŠŸ",
  "data": {
    "videoId": 1,
    "status": "processing",
    "progress": 75,
    "hlsUrl": "http://localhost:3001/api/stream/1/playlist.m3u8",
    "thumbnailUrl": "http://localhost:3001/thumbnails/2025/07/4/thumbnail.jpg",
    "queueJob": {
      "id": 123,
      "status": "processing",
      "priority": 1,
      "retryCount": 0,
      "maxRetries": 3,
      "errorMessage": null,
      "createdAt": "2023-12-01T10:00:00.000Z",
      "startedAt": "2023-12-01T10:01:00.000Z",
      "completedAt": null
    }
  },
  "timestamp": "2023-12-01T10:05:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

### 3. é‡è¯•è½¬æ¢

#### POST `/api/hls/:id/retry`
**æè¿°**: é‡è¯•å¤±è´¥çš„è½¬æ¢ä»»åŠ¡

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**è¯·æ±‚å‚æ•°**:
```json
{
  "quality": "string",      // å¯é€‰ï¼Œè½¬æ¢è´¨é‡ï¼šlow/medium/highï¼Œé»˜è®¤medium
  "resolution": "string"    // å¯é€‰ï¼Œåˆ†è¾¨ç‡ï¼š480p/720p/1080pï¼Œé»˜è®¤720p
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è§†é¢‘è½¬æ¢é‡è¯•å·²å¼€å§‹",
  "data": {
    "videoId": 1,
    "jobId": 124,
    "status": "queued"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯æˆ–ä¸šåŠ¡é”™è¯¯ï¼ˆåªèƒ½é‡è¯•å¤±è´¥çš„è½¬æ¢ä»»åŠ¡ï¼‰
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨

## æµåª’ä½“æ’­æ”¾æ¨¡å—

Base URL: `/api/stream`

**æ³¨æ„**: æ‰€æœ‰æµåª’ä½“æ¥å£éƒ½éœ€è¦JWTè®¤è¯

### 1. è·å–HLSæ’­æ”¾åˆ—è¡¨

#### GET `/api/stream/:id/playlist.m3u8`
**æè¿°**: è·å–è§†é¢‘çš„HLSæ’­æ”¾åˆ—è¡¨æ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**å“åº”æ ¼å¼**: `application/vnd.apple.mpegurl`

**æˆåŠŸå“åº” (200)**:
è¿”å›M3U8æ ¼å¼çš„æ’­æ”¾åˆ—è¡¨æ–‡ä»¶å†…å®¹

**å“åº”å¤´**:
```
Content-Type: application/vnd.apple.mpegurl
Cache-Control: no-cache
Access-Control-Allow-Origin: *
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨æˆ–æ’­æ”¾åˆ—è¡¨æ–‡ä»¶ä¸å­˜åœ¨
- `400` - è§†é¢‘å°šæœªå‡†å¤‡å¥½æ’­æ”¾

### 2. è·å–è§†é¢‘ç‰‡æ®µ

#### GET `/api/stream/:id/segment_:segmentId.ts`
**æè¿°**: è·å–HLSè§†é¢‘ç‰‡æ®µæ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID
- `segmentId` (string): ç‰‡æ®µID

**å“åº”æ ¼å¼**: `video/mp2t`

**æˆåŠŸå“åº” (200)**:
è¿”å›è§†é¢‘ç‰‡æ®µäºŒè¿›åˆ¶æ•°æ®æµ

**å“åº”å¤´**:
```
Content-Type: video/mp2t
Cache-Control: public, max-age=31536000
Access-Control-Allow-Origin: *
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®
- `404` - è§†é¢‘ä¸å­˜åœ¨æˆ–ç‰‡æ®µæ–‡ä»¶ä¸å­˜åœ¨
- `400` - è§†é¢‘å°šæœªå‡†å¤‡å¥½æ’­æ”¾

## è§†é¢‘åˆ†äº«æ¨¡å—

Base URL: `/api/share`

### ç®¡ç†ç«¯ç‚¹ï¼ˆéœ€è¦è®¤è¯ï¼‰

### 1. åˆ‡æ¢åˆ†äº«çŠ¶æ€

#### PUT `/api/share/manage/shares/:shareId/toggle`
**æè¿°**: å¯ç”¨æˆ–ç¦ç”¨æŒ‡å®šçš„åˆ†äº«é“¾æ¥

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `shareId` (number): åˆ†äº«ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "åˆ†äº«é“¾æ¥å·²å¯ç”¨", // æˆ– "åˆ†äº«é“¾æ¥å·²ç¦ç”¨"
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†äº«IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - åˆ†äº«é“¾æ¥ä¸å­˜åœ¨

### 2. åˆ é™¤åˆ†äº«é“¾æ¥

#### DELETE `/api/share/manage/shares/:shareId`
**æè¿°**: åˆ é™¤æŒ‡å®šçš„åˆ†äº«é“¾æ¥

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `shareId` (number): åˆ†äº«ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "åˆ†äº«é“¾æ¥åˆ é™¤æˆåŠŸ",
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†äº«IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - åˆ†äº«é“¾æ¥ä¸å­˜åœ¨

### å…¬å¼€ç«¯ç‚¹ï¼ˆæ— éœ€è®¤è¯ï¼‰

### 3. è·å–åˆ†äº«æ’­æ”¾åˆ—è¡¨

#### GET `/api/share/:token/playlist.m3u8`
**æè¿°**: é€šè¿‡åˆ†äº«ä»¤ç‰Œè·å–HLSæ’­æ”¾åˆ—è¡¨ï¼Œæ— éœ€ç”¨æˆ·è®¤è¯

**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:
- `token` (string): åˆ†äº«è®¿é—®ä»¤ç‰Œï¼ˆUUIDæ ¼å¼ï¼‰

**å“åº”æ ¼å¼**: `application/vnd.apple.mpegurl`

**æˆåŠŸå“åº” (200)**:
è¿”å›M3U8æ ¼å¼çš„æ’­æ”¾åˆ—è¡¨æ–‡ä»¶å†…å®¹ï¼Œæ‰€æœ‰åˆ†ç‰‡URLå·²è½¬æ¢ä¸ºå®Œæ•´è·¯å¾„

**å“åº”å¤´**:
```
Content-Type: application/vnd.apple.mpegurl
Cache-Control: no-cache
Access-Control-Allow-Origin: *
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†äº«ä»¤ç‰Œæ— æ•ˆ
- `404` - åˆ†äº«é“¾æ¥æ— æ•ˆæˆ–å·²å¤±æ•ˆ

### 4. è·å–åˆ†äº«è§†é¢‘åˆ†ç‰‡

#### GET `/api/share/:token/segment_:segmentId.ts`
**æè¿°**: é€šè¿‡åˆ†äº«ä»¤ç‰Œè·å–HLSè§†é¢‘åˆ†ç‰‡ï¼Œæ— éœ€ç”¨æˆ·è®¤è¯

**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:
- `token` (string): åˆ†äº«è®¿é—®ä»¤ç‰Œï¼ˆUUIDæ ¼å¼ï¼‰
- `segmentId` (string): è§†é¢‘åˆ†ç‰‡ID

**å“åº”æ ¼å¼**: `video/mp2t`

**æˆåŠŸå“åº” (200)**:
è¿”å›è§†é¢‘åˆ†ç‰‡äºŒè¿›åˆ¶æ•°æ®æµ

**å“åº”å¤´**:
```
Content-Type: video/mp2t
Cache-Control: public, max-age=31536000
Access-Control-Allow-Origin: *
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†äº«ä»¤ç‰Œæˆ–åˆ†ç‰‡IDæ— æ•ˆ
- `404` - åˆ†äº«é“¾æ¥æ— æ•ˆæˆ–è§†é¢‘åˆ†ç‰‡ä¸å­˜åœ¨

### 5. è·å–åˆ†äº«ä¿¡æ¯

#### GET `/api/share/:token/info`
**æè¿°**: è·å–åˆ†äº«è§†é¢‘çš„åŸºæœ¬ä¿¡æ¯

**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:
- `token` (string): åˆ†äº«è®¿é—®ä»¤ç‰Œï¼ˆUUIDæ ¼å¼ï¼‰

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–åˆ†äº«ä¿¡æ¯æˆåŠŸ",
  "data": {
    "title": "æµ‹è¯•è§†é¢‘",
    "duration": 2566,
    "shared_at": "2024-07-16T12:00:00.000Z",
    "view_count": 25
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - åˆ†äº«ä»¤ç‰Œæ— æ•ˆ
- `404` - åˆ†äº«é“¾æ¥æ— æ•ˆæˆ–å·²å¤±æ•ˆ

### åˆ†äº«é“¾æ¥ç‰¹æ€§

#### å®‰å…¨ç‰¹æ€§
- **UUIDéšæœºæ€§**: ä½¿ç”¨åŠ å¯†å®‰å…¨çš„UUID v4ï¼Œæ— æ³•è¢«éå†æˆ–çŒœæµ‹
- **çŠ¶æ€æ§åˆ¶**: æ”¯æŒå¯ç”¨/ç¦ç”¨åˆ†äº«é“¾æ¥ï¼Œä¾¿äºç®¡ç†
- **æƒé™éªŒè¯**: åªæœ‰è§†é¢‘æ‰€æœ‰è€…æ‰èƒ½ç®¡ç†åˆ†äº«é“¾æ¥
- **è®¿é—®ç»Ÿè®¡**: è‡ªåŠ¨è®°å½•è®¿é—®æ¬¡æ•°å’Œæœ€åè®¿é—®æ—¶é—´

#### æ€§èƒ½ä¼˜åŒ–
- **é•¿æœŸç¼“å­˜**: è§†é¢‘åˆ†ç‰‡ç¼“å­˜1å¹´ï¼Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½
- **å®æ—¶æ’­æ”¾åˆ—è¡¨**: æ’­æ”¾åˆ—è¡¨ä¸ç¼“å­˜ï¼Œç¡®ä¿URLå‡†ç¡®æ€§
- **æµå¼ä¼ è¾“**: ä½¿ç”¨Node.jsæµé¿å…å†…å­˜å ç”¨

#### ä½¿ç”¨åœºæ™¯
- **æ°¸ä¹…åˆ†äº«**: é“¾æ¥æ°¸ä¹…æœ‰æ•ˆï¼Œé€‚åˆé•¿æœŸåˆ†äº«
- **æ— è®¤è¯è®¿é—®**: æ¥æ”¶æ–¹æ— éœ€æ³¨å†Œè´¦å·å³å¯è§‚çœ‹
- **è·¨å¹³å°å…¼å®¹**: æ”¯æŒæ‰€æœ‰æ ‡å‡†HLSæ’­æ”¾å™¨
- **ç»Ÿè®¡è¿½è¸ª**: å¯æŸ¥çœ‹åˆ†äº«é“¾æ¥çš„è®¿é—®æƒ…å†µ

## é˜Ÿåˆ—ç®¡ç†æ¨¡å—

Base URL: `/api/queue`

**æ³¨æ„**: æ‰€æœ‰é˜Ÿåˆ—æ¥å£éƒ½éœ€è¦JWTè®¤è¯

### 1. è·å–é˜Ÿåˆ—çŠ¶æ€

#### GET `/api/queue/status`
**æè¿°**: è·å–æ•´ä½“é˜Ÿåˆ—çŠ¶æ€æ¦‚è§ˆ

**è®¤è¯**: éœ€è¦JWT Token

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–é˜Ÿåˆ—çŠ¶æ€æˆåŠŸ",
  "data": {
    "pending": 5,
    "processing": 2,
    "completed": 120,
    "failed": 3,
    "maxConcurrent": 3
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®

### 2. è·å–è§†é¢‘é˜Ÿåˆ—çŠ¶æ€

#### GET `/api/queue/video/:id`
**æè¿°**: è·å–æŒ‡å®šè§†é¢‘çš„é˜Ÿåˆ—ä»»åŠ¡çŠ¶æ€

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `id` (number): è§†é¢‘ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–è§†é¢‘é˜Ÿåˆ—çŠ¶æ€æˆåŠŸ",
  "data": {
    "id": 123,
    "videoId": 1,
    "status": "processing",
    "priority": 1,
    "retryCount": 0,
    "maxRetries": 3,
    "errorMessage": null,
    "createdAt": "2023-12-01T10:00:00.000Z",
    "startedAt": "2023-12-01T10:01:00.000Z",
    "completedAt": null
  },
  "timestamp": "2023-12-01T10:05:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - è§†é¢‘IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - æœªæ‰¾åˆ°è¯¥è§†é¢‘çš„é˜Ÿåˆ—ä»»åŠ¡

### 3. é‡è¯•å¤±è´¥ä»»åŠ¡

#### POST `/api/queue/retry/:jobId`
**æè¿°**: é‡è¯•æŒ‡å®šçš„å¤±è´¥ä»»åŠ¡

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `jobId` (number): ä»»åŠ¡ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "ä»»åŠ¡é‡è¯•å·²å¼€å§‹",
  "data": {
    "jobId": 123,
    "status": "retrying"
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - ä»»åŠ¡IDæ— æ•ˆæˆ–ä»»åŠ¡ä¸æ˜¯å¤±è´¥çŠ¶æ€
- `401` - æœªæˆæƒè®¿é—®

### 4. è®¾ç½®æœ€å¤§å¹¶å‘æ•°

#### POST `/api/queue/config/concurrency`
**æè¿°**: è®¾ç½®é˜Ÿåˆ—æœ€å¤§å¹¶å‘å¤„ç†æ•°

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚å‚æ•°**:
```json
{
  "maxConcurrent": 5      // æœ€å¤§å¹¶å‘æ•°ï¼ŒèŒƒå›´1-10
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "æœ€å¤§å¹¶å‘æ•°æ›´æ–°æˆåŠŸ",
  "data": {
    "maxConcurrent": 5
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆå¹¶å‘æ•°ä¸åœ¨1-10èŒƒå›´å†…ï¼‰
- `401` - æœªæˆæƒè®¿é—®

### 5. æ¸…ç†å·²å®Œæˆä»»åŠ¡

#### POST `/api/queue/cleanup`
**æè¿°**: æ¸…ç†å·²å®Œæˆçš„ä»»åŠ¡è®°å½•

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚å‚æ•°**:
```json
{
  "keepCount": 100        // ä¿ç•™çš„ä»»åŠ¡æ•°é‡ï¼ŒèŒƒå›´1-1000ï¼Œé»˜è®¤100
}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "ä»»åŠ¡æ¸…ç†å®Œæˆ",
  "data": {
    "keepCount": 100
  },
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆä¿ç•™æ•°é‡ä¸åœ¨1-1000èŒƒå›´å†…ï¼‰
- `401` - æœªæˆæƒè®¿é—®

## åˆ†ç‰‡ä¸Šä¼ æ¨¡å—

Base URL: `/api/upload`

**æ³¨æ„**: æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ æ¥å£éƒ½éœ€è¦JWTè®¤è¯

### 1. åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ 

#### POST `/api/upload/init`
**æè¿°**: åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ ä¼šè¯ï¼Œä¸ºå¤§æ–‡ä»¶ä¸Šä¼ åšå‡†å¤‡

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚å‚æ•°**:
```json
{
  "filename": "string",      // åŸå§‹æ–‡ä»¶åï¼Œå¿…å¡«
  "fileSize": "number",      // æ–‡ä»¶æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå¿…å¡«
  "chunkSize": "number"      // åˆ†ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå¯é€‰ï¼Œé»˜è®¤5MB
}
```

**æˆåŠŸå“åº” (201)**:
```json
{
  "success": true,
  "code": 201,
  "message": "åˆ†ç‰‡ä¸Šä¼ åˆå§‹åŒ–æˆåŠŸ",
  "data": {
    "id": "upload_uuid_123",
    "filename": "video.mp4",
    "file_size": 104857600,
    "total_chunks": 20,
    "chunk_size": 5242880,
    "uploaded_chunks": [],
    "status": "uploading",
    "expires_at": "2024-07-17T12:00:00.000Z",
    "created_at": "2024-07-16T12:00:00.000Z",
    "updated_at": "2024-07-16T12:00:00.000Z"
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯ï¼ˆæ–‡ä»¶åæˆ–å¤§å°æ— æ•ˆï¼‰
- `401` - æœªæˆæƒè®¿é—®

### 2. ä¸Šä¼ åˆ†ç‰‡

#### POST `/api/upload/chunk`
**æè¿°**: ä¸Šä¼ å•ä¸ªæ–‡ä»¶åˆ†ç‰‡

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
- `uploadId` (string): ä¸Šä¼ ä¼šè¯IDï¼Œå¿…å¡«
- `chunkNumber` (number): åˆ†ç‰‡åºå·ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œå¿…å¡«
- `chunk` (file): åˆ†ç‰‡æ–‡ä»¶æ•°æ®ï¼Œå¿…å¡«

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "åˆ†ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "uploadId": "upload_uuid_123",
    "chunkNumber": 5,
    "uploadedChunks": [0, 1, 2, 3, 4, 5],
    "totalChunks": 20,
    "isComplete": false
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯æˆ–ä¸Šä¼ ä¼šè¯æ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - ä¸Šä¼ ä¼šè¯ä¸å­˜åœ¨

### 3. å®Œæˆä¸Šä¼ 

#### POST `/api/upload/complete`
**æè¿°**: å®Œæˆåˆ†ç‰‡ä¸Šä¼ ï¼Œåˆå¹¶æ‰€æœ‰åˆ†ç‰‡å¹¶åˆ›å»ºè§†é¢‘è®°å½•

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚å‚æ•°**:
```json
{
  "uploadId": "string",      // ä¸Šä¼ ä¼šè¯IDï¼Œå¿…å¡«
  "title": "string"          // è§†é¢‘æ ‡é¢˜ï¼Œå¿…å¡«
}
```

**æˆåŠŸå“åº” (201)**:
```json
{
  "success": true,
  "code": 201,
  "message": "ä¸Šä¼ å®Œæˆ",
  "data": {
    "id": 1,
    "title": "æµ‹è¯•è§†é¢‘",
    "original_filename": "video.mp4",
    "file_size": 104857600,
    "status": "uploaded",
    "conversion_progress": 0,
    "created_at": "2024-07-16T12:00:00.000Z",
    "updated_at": "2024-07-16T12:00:00.000Z"
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - å‚æ•°é”™è¯¯æˆ–åˆ†ç‰‡ä¸å®Œæ•´
- `401` - æœªæˆæƒè®¿é—®
- `404` - ä¸Šä¼ ä¼šè¯ä¸å­˜åœ¨

### 4. è·å–ä¸Šä¼ çŠ¶æ€

#### GET `/api/upload/status/:uploadId`
**æè¿°**: è·å–åˆ†ç‰‡ä¸Šä¼ ä¼šè¯çš„å½“å‰çŠ¶æ€

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `uploadId` (string): ä¸Šä¼ ä¼šè¯ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–ä¸Šä¼ çŠ¶æ€æˆåŠŸ",
  "data": {
    "id": "upload_uuid_123",
    "filename": "video.mp4",
    "file_size": 104857600,
    "total_chunks": 20,
    "chunk_size": 5242880,
    "uploaded_chunks": [0, 1, 2, 3, 4, 5],
    "status": "uploading",
    "expires_at": "2024-07-17T12:00:00.000Z",
    "created_at": "2024-07-16T12:00:00.000Z",
    "updated_at": "2024-07-16T12:00:00.000Z"
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - ä¸Šä¼ IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - ä¸Šä¼ ä¼šè¯ä¸å­˜åœ¨

### 5. å–æ¶ˆä¸Šä¼ 

#### DELETE `/api/upload/:uploadId`
**æè¿°**: å–æ¶ˆåˆ†ç‰‡ä¸Šä¼ ä¼šè¯å¹¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**è·¯å¾„å‚æ•°**:
- `uploadId` (string): ä¸Šä¼ ä¼šè¯ID

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "ä¸Šä¼ å·²å–æ¶ˆ",
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `400` - ä¸Šä¼ IDæ— æ•ˆ
- `401` - æœªæˆæƒè®¿é—®
- `404` - ä¸Šä¼ ä¼šè¯ä¸å­˜åœ¨

### 6. æ‰‹åŠ¨æ¸…ç†è¿‡æœŸä¸Šä¼ 

#### POST `/api/upload/cleanup`
**æè¿°**: æ‰‹åŠ¨è§¦å‘æ¸…ç†è¿‡æœŸçš„ä¸Šä¼ ä¼šè¯å’Œä¸´æ—¶æ–‡ä»¶

**è®¤è¯**: éœ€è¦JWT Token

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "æ¸…ç†å®Œæˆ",
  "data": {
    "cleaned_sessions": 5,
    "cleaned_files": 23,
    "freed_space": 1073741824
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®

### 7. è·å–æ¸…ç†çŠ¶æ€

#### GET `/api/upload/cleanup/status`
**æè¿°**: è·å–ä¸Šä¼ æ¸…ç†æœåŠ¡çš„çŠ¶æ€ä¿¡æ¯

**è®¤è¯**: éœ€è¦JWT Token

**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–æ¸…ç†çŠ¶æ€æˆåŠŸ",
  "data": {
    "last_cleanup": "2024-07-16T10:00:00.000Z",
    "active_sessions": 3,
    "expired_sessions": 0,
    "total_temp_size": 52428800,
    "next_scheduled_cleanup": "2024-07-16T14:00:00.000Z"
  },
  "timestamp": "2024-07-16T12:00:00.000Z"
}
```

**é”™è¯¯å“åº”**:
- `401` - æœªæˆæƒè®¿é—®

### åˆ†ç‰‡ä¸Šä¼ ç‰¹æ€§

#### æŠ€æœ¯ç‰¹æ€§
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒä¸Šä¼ ä¸­æ–­åä»å·²ä¸Šä¼ çš„åˆ†ç‰‡ç»§ç»­
- **å¹¶å‘ä¸Šä¼ **: æ”¯æŒå¤šä¸ªåˆ†ç‰‡å¹¶è¡Œä¸Šä¼ ï¼Œæé«˜ä¼ è¾“æ•ˆç‡
- **è‡ªåŠ¨é‡è¯•**: åˆ†ç‰‡ä¸Šä¼ å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼Œæé«˜æˆåŠŸç‡
- **è¿‡æœŸæ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„ä¸Šä¼ ä¼šè¯å’Œä¸´æ—¶æ–‡ä»¶

#### æ€§èƒ½ä¼˜åŒ–
- **åˆ†ç‰‡å¤§å°**: é»˜è®¤5MBï¼Œå¯æ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´
- **å¹¶å‘æ§åˆ¶**: å®¢æˆ·ç«¯æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…è¿‡è½½
- **å†…å­˜ä¼˜åŒ–**: æµå¼å¤„ç†å¤§æ–‡ä»¶ï¼Œå‡å°‘å†…å­˜å ç”¨
- **å­˜å‚¨æ•ˆç‡**: ä¸´æ—¶æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ï¼Œå®šæœŸæ¸…ç†

#### ä½¿ç”¨åœºæ™¯
- **å¤§æ–‡ä»¶ä¸Šä¼ **: æ¨èæ–‡ä»¶å¤§å°è¶…è¿‡10MBæ—¶ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ 
- **ç½‘ç»œä¸ç¨³å®š**: åœ¨ç½‘ç»œæ¡ä»¶ä¸ä½³æ—¶æä¾›æ›´å¥½çš„ä¸Šä¼ ä½“éªŒ
- **ç§»åŠ¨è®¾å¤‡**: ç§»åŠ¨ç«¯ä¸Šä¼ å¤§æ–‡ä»¶çš„ç†æƒ³é€‰æ‹©
- **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šæ–‡ä»¶å¹¶è¡Œä¸Šä¼ 

## é™æ€æ–‡ä»¶è®¿é—®

### 1. ç¼©ç•¥å›¾è®¿é—®
- **URL**: `/thumbnails/*`
- **æè¿°**: è®¿é—®è§†é¢‘ç¼©ç•¥å›¾æ–‡ä»¶
- **è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆé€šè¿‡é™æ€æ–‡ä»¶æœåŠ¡ï¼‰

## é”™è¯¯ç è¯´æ˜

### HTTPçŠ¶æ€ç 
- `200` - è¯·æ±‚æˆåŠŸ
- `201` - åˆ›å»ºæˆåŠŸ
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401` - æœªæˆæƒ/è®¤è¯å¤±è´¥
- `403` - æƒé™ä¸è¶³
- `404` - èµ„æºä¸å­˜åœ¨
- `409` - èµ„æºå†²çª
- `500` - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### ä¸šåŠ¡é”™è¯¯ç±»å‹
- `VALIDATION_ERROR` - éªŒè¯é”™è¯¯
- `AUTHENTICATION_ERROR` - è®¤è¯é”™è¯¯
- `AUTHORIZATION_ERROR` - æˆæƒé”™è¯¯
- `NOT_FOUND_ERROR` - èµ„æºä¸å­˜åœ¨
- `CONFLICT_ERROR` - èµ„æºå†²çª
- `BUSINESS_ERROR` - ä¸šåŠ¡é€»è¾‘é”™è¯¯
- `INTERNAL_ERROR` - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯

### ä¸šåŠ¡é”™è¯¯ä»£ç 
- `INVALID_PARAMS` - æ— æ•ˆå‚æ•°
- `MISSING_REQUIRED_FIELDS` - ç¼ºå°‘å¿…å¡«å­—æ®µ
- `INVALID_CREDENTIALS` - è®¤è¯ä¿¡æ¯æ— æ•ˆ
- `ACCESS_DENIED` - è®¿é—®è¢«æ‹’ç»
- `RESOURCE_NOT_FOUND` - èµ„æºä¸å­˜åœ¨
- `RESOURCE_ALREADY_EXISTS` - èµ„æºå·²å­˜åœ¨
- `VIDEO_ALREADY_PROCESSING` - è§†é¢‘æ­£åœ¨å¤„ç†ä¸­
- `VIDEO_NOT_READY` - è§†é¢‘æœªå‡†å¤‡å¥½
- `QUEUE_FULL` - é˜Ÿåˆ—å·²æ»¡
- `FILE_OPERATION_ERROR` - æ–‡ä»¶æ“ä½œé”™è¯¯

### è§†é¢‘çŠ¶æ€è¯´æ˜
- `uploaded` - å·²ä¸Šä¼ ï¼Œç­‰å¾…å¤„ç†
- `processing` - æ­£åœ¨å¤„ç†ä¸­
- `completed` - å¤„ç†å®Œæˆï¼Œå¯ä»¥æ’­æ”¾
- `failed` - å¤„ç†å¤±è´¥
- `deleted` - å·²åˆ é™¤

## æ•°æ®ç»“æ„å®šä¹‰

### ç”¨æˆ·ç›¸å…³

#### UserResponse
```typescript
{
  id: number;              // ç”¨æˆ·ID
  username: string;        // ç”¨æˆ·å
  email: string;           // é‚®ç®±åœ°å€
  created_at: string;      // åˆ›å»ºæ—¶é—´
  updated_at: string;      // æ›´æ–°æ—¶é—´
}
```

#### AuthResponse
```typescript
{
  token: string;           // JWTè®¿é—®ä»¤ç‰Œ
  user: UserResponse;      // ç”¨æˆ·ä¿¡æ¯
}
```

### è§†é¢‘ç›¸å…³

#### VideoResponse
```typescript
{
  id: number;                    // è§†é¢‘ID
  title: string;                 // è§†é¢‘æ ‡é¢˜
  original_filename: string;     // åŸå§‹æ–‡ä»¶å
  duration?: number;             // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
  file_size: number;             // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  status: VideoStatus;           // è§†é¢‘çŠ¶æ€
  conversion_progress: number;   // è½¬æ¢è¿›åº¦ï¼ˆ0-100ï¼‰
  thumbnail_url?: string;       // ç¼©ç•¥å›¾å®Œæ•´URL
  hls_url?: string;            // HLSæ’­æ”¾å®Œæ•´URL
  created_at: string;           // åˆ›å»ºæ—¶é—´
  updated_at: string;           // æ›´æ–°æ—¶é—´
}
```

#### VideoStatusæšä¸¾
```typescript
enum VideoStatus {
  UPLOADED = 'uploaded',     // å·²ä¸Šä¼ 
  PROCESSING = 'processing', // å¤„ç†ä¸­
  COMPLETED = 'completed',   // å·²å®Œæˆ
  FAILED = 'failed',         // å¤±è´¥
  DELETED = 'deleted'        // å·²åˆ é™¤
}
```

### åˆ†é¡µç›¸å…³

#### PaginationMeta
```typescript
{
  page: number;            // å½“å‰é¡µç 
  limit: number;           // æ¯é¡µæ•°é‡
  total: number;           // æ€»è®°å½•æ•°
  pages: number;           // æ€»é¡µæ•°
  has_next: boolean;       // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
  has_prev: boolean;       // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
}
```

#### SearchMeta
```typescript
{
  query?: string | null;     // æœç´¢å…³é”®è¯
  status?: string | null;    // çŠ¶æ€ç­›é€‰
  start_date?: string | null; // å¼€å§‹æ—¥æœŸ
  end_date?: string | null;   // ç»“æŸæ—¥æœŸ
  sort_by?: string;          // æ’åºå­—æ®µ
  sort_order?: string;       // æ’åºæ–¹å‘
}
```

### é˜Ÿåˆ—ç›¸å…³

#### QueueJob
```typescript
{
  id: number;              // ä»»åŠ¡ID
  videoId: number;         // è§†é¢‘ID
  status: string;          // ä»»åŠ¡çŠ¶æ€ï¼špending/processing/completed/failed
  priority: number;        // ä»»åŠ¡ä¼˜å…ˆçº§
  retryCount: number;      // é‡è¯•æ¬¡æ•°
  maxRetries: number;      // æœ€å¤§é‡è¯•æ¬¡æ•°
  errorMessage?: string;   // é”™è¯¯ä¿¡æ¯
  createdAt: string;       // åˆ›å»ºæ—¶é—´
  startedAt?: string;      // å¼€å§‹æ—¶é—´
  completedAt?: string;    // å®Œæˆæ—¶é—´
}
```

### åˆ†äº«ç›¸å…³

#### ShareResponse
```typescript
{
  id: number;              // åˆ†äº«è®°å½•ID
  video_id: number;        // è§†é¢‘ID
  access_token: string;    // è®¿é—®ä»¤ç‰Œï¼ˆUUIDæ ¼å¼ï¼‰
  share_url: string;       // å®Œæ•´çš„åˆ†äº«URL
  created_at: string;      // åˆ›å»ºæ—¶é—´
  is_active: boolean;      // æ˜¯å¦å¯ç”¨
  access_count: number;    // è®¿é—®æ¬¡æ•°
}
```

#### ShareInfo
```typescript
{
  title: string;           // è§†é¢‘æ ‡é¢˜
  duration?: number;       // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
  shared_at: string;       // åˆ†äº«åˆ›å»ºæ—¶é—´
  view_count: number;      // è§‚çœ‹æ¬¡æ•°
}
```

### åˆ†ç‰‡ä¸Šä¼ ç›¸å…³

#### UploadSession
```typescript
{
  id: string;              // ä¸Šä¼ ä¼šè¯IDï¼ˆUUIDæ ¼å¼ï¼‰
  filename: string;        // åŸå§‹æ–‡ä»¶å
  file_size: number;       // æ–‡ä»¶æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  total_chunks: number;    // æ€»åˆ†ç‰‡æ•°
  chunk_size: number;      // åˆ†ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  uploaded_chunks: number[]; // å·²ä¸Šä¼ çš„åˆ†ç‰‡åºå·æ•°ç»„
  status: UploadSessionStatus; // ä¸Šä¼ çŠ¶æ€
  expires_at: string;      // è¿‡æœŸæ—¶é—´
  created_at: string;      // åˆ›å»ºæ—¶é—´
  updated_at: string;      // æ›´æ–°æ—¶é—´
}
```

#### UploadSessionStatusæšä¸¾
```typescript
enum UploadSessionStatus {
  UPLOADING = 'uploading',   // ä¸Šä¼ ä¸­
  COMPLETED = 'completed',   // å·²å®Œæˆ
  FAILED = 'failed',         // å¤±è´¥
  CANCELLED = 'cancelled',   // å·²å–æ¶ˆ
  EXPIRED = 'expired'        // å·²è¿‡æœŸ
}
```

#### InitChunkedUploadRequest
```typescript
{
  filename: string;        // åŸå§‹æ–‡ä»¶å
  fileSize: number;        // æ–‡ä»¶æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  chunkSize?: number;      // åˆ†ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå¯é€‰
}
```

#### UploadChunkResponse
```typescript
{
  uploadId: string;        // ä¸Šä¼ ä¼šè¯ID
  chunkNumber: number;     // å½“å‰åˆ†ç‰‡åºå·
  uploadedChunks: number[]; // å·²ä¸Šä¼ çš„åˆ†ç‰‡åºå·æ•°ç»„
  totalChunks: number;     // æ€»åˆ†ç‰‡æ•°
  isComplete: boolean;     // æ˜¯å¦æ‰€æœ‰åˆ†ç‰‡éƒ½å·²ä¸Šä¼ 
}
```

#### CleanupStatusResponse
```typescript
{
  last_cleanup: string;           // ä¸Šæ¬¡æ¸…ç†æ—¶é—´
  active_sessions: number;        // æ´»è·ƒä¼šè¯æ•°
  expired_sessions: number;       // è¿‡æœŸä¼šè¯æ•°
  total_temp_size: number;        // ä¸´æ—¶æ–‡ä»¶æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  next_scheduled_cleanup: string; // ä¸‹æ¬¡è®¡åˆ’æ¸…ç†æ—¶é—´
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.4.0  
**æœ€åæ›´æ–°**: 2024å¹´7æœˆ  
**ç»´æŠ¤è€…**: HLSmith å¼€å‘å›¢é˜Ÿ  

### æ›´æ–°æ—¥å¿—

#### v1.4.0 (2024-07-16)
- ğŸ”„ **é‡å¤§å˜æ›´**: APIå“åº”å­—æ®µåç§°æ›´æ–°
  - `thumbnail_path` â†’ `thumbnail_url` 
  - `hls_path` â†’ `hls_url`
- âœ¨ æ‰€æœ‰è§†é¢‘ç›¸å…³æ¥å£ç°åœ¨è¿”å›å®Œæ•´çš„URLè€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„
  - ç¼©ç•¥å›¾URL: `http://localhost:3001/thumbnails/2025/07/4/thumbnail.jpg`
  - HLSæ’­æ”¾URL: `http://localhost:3001/api/stream/4/playlist.m3u8`
- ğŸ”§ ä¼˜åŒ–URLæ„å»ºé€»è¾‘ï¼Œæ”¯æŒBASE_URLç¯å¢ƒå˜é‡é…ç½®
- ğŸ“ æ›´æ–°APIæ–‡æ¡£å’Œæ•°æ®ç»“æ„å®šä¹‰

#### v1.3.0 (2024-07-16)
- âœ¨ æ–°å¢è§†é¢‘æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰æ ‡é¢˜å…³é”®è¯æœç´¢
- âœ¨ æ–°å¢è§†é¢‘ç­›é€‰åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰çŠ¶æ€ã€æ—¥æœŸèŒƒå›´ç­›é€‰
- âœ¨ æ–°å¢è§†é¢‘æ’åºåŠŸèƒ½ï¼Œæ”¯æŒå¤šå­—æ®µæ’åºï¼ˆåˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€æ ‡é¢˜ã€æ–‡ä»¶å¤§å°ã€æ—¶é•¿ï¼‰
- âœ¨ æ–°å¢æœç´¢å…ƒæ•°æ®è¿”å›ï¼ŒåŒ…å«å½“å‰æœç´¢å’Œæ’åºæ¡ä»¶
- ğŸ”§ æ‰©å±•APIå“åº”ç»“æ„ï¼Œæ”¯æŒæœç´¢ç›¸å…³çš„å…ƒæ•°æ®
- ğŸ“ å®Œå–„è§†é¢‘åˆ—è¡¨APIæ–‡æ¡£ï¼Œæ·»åŠ æœç´¢å‚æ•°è¯´æ˜

#### v1.2.0 (2024-07-16)
- âœ¨ æ–°å¢åˆ†ç‰‡ä¸Šä¼ æ¨¡å—ï¼Œæ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ 
- âœ¨ æ–°å¢æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œæå‡ä¸Šä¼ ä½“éªŒ
- âœ¨ æ–°å¢ä¸Šä¼ ä¼šè¯ç®¡ç†å’ŒçŠ¶æ€æŸ¥è¯¢
- âœ¨ æ–°å¢è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¸Šä¼ çš„æœºåˆ¶
- ğŸ”§ å®Œå–„é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
- ğŸ“ æ–°å¢åˆ†ç‰‡ä¸Šä¼ APIå®Œæ•´æ–‡æ¡£

#### v1.1.0 (2024-07-16)
- âœ¨ æ–°å¢è§†é¢‘åˆ†äº«æ¨¡å—
- âœ¨ æ–°å¢UUIDæ°¸ä¹…åˆ†äº«é“¾æ¥åŠŸèƒ½
- âœ¨ æ–°å¢æ— è®¤è¯çš„å…¬å¼€æ’­æ”¾ç«¯ç‚¹
- âœ¨ æ–°å¢åˆ†äº«é“¾æ¥ç®¡ç†åŠŸèƒ½
- âœ¨ æ–°å¢è®¿é—®ç»Ÿè®¡å’ŒçŠ¶æ€æ§åˆ¶
- ğŸ“ å®Œå–„APIæ–‡æ¡£ç»“æ„å’Œç¤ºä¾‹